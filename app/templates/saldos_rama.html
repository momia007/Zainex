{% extends 'base.html' %}
{% import 'partials/moneda_arg.html' as moneda %}

{% block titulo %}
  Saldos por Rama
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/saldos_rama.css') }}">
{% endblock %}

{% block encabezado %}
  <h1 class="encabezado">üè∑Ô∏è Saldos por Rama</h1>
{% endblock %}

{% block content %}
  <div class="container">
    <!-- Formulario para seleccionar rama -->
    <form method="POST" action="{{ url_for('contabilidad.saldos_rama') }}">
      <div class="selectores">
        <label for="rama_id">Seleccion√° una rama:</label>
        <select name="rama_id" id="rama_id" class="selector-peque√±o" required>
          {% for rama in ramas %}
            {% if rama.id != 5 %}
              <option value="{{ rama.id }}" {% if rama_seleccionada and rama.id == rama_seleccionada.id %}selected{% endif %}>
                {{ rama.nombre }}
              </option>
            {% endif %}
          {% endfor %}
        </select>


        <label for="a√±o">A√±o:</label>
        <select name="a√±o" id="a√±o" class="selector-peque√±o" required>
          {% for a√±o in a√±os %}
            <option value="{{ a√±o }}" {% if a√±o_seleccionado == a√±o %}selected{% endif %}>{{ a√±o }}</option>
          {% endfor %}
        </select>

      </div>
      <div class ="botonera">
        <button type="submit">Consultar</button>
        <button type="button" onclick="window.location.href='/contabilidad'">Cancelar</button>
      </div>  
    </form>

    {% if error %}
      <div class="alerta-error">
        ‚ö†Ô∏è {{ error }}
      </div>
    {% endif %}


    {% if rama_seleccionada %}
      <!-- Mostrar saldo libre disponible -->
      <h2>üí∞ Saldo libre disponible para la rama {{ rama_seleccionada.nombre }} en {{ a√±o_seleccionado }}</h2>
      <h2><strong>{{ moneda.formato_monto(saldo_libre) }}</strong></h2>
      <p>({{ porcentaje }}% de ingresos por cuotas menos gastos)</p>

      <!-- Tabla de movimientos filtrados -->
      <h3>üìã Movimientos registrados</h3>
      {% if movimientos %}
        <table class="libro-caja">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Tipo</th>
              <th>Rubro</th>
              <th>Importe</th>
              <th>Detalle</th>
            </tr>
          </thead>
          <tbody>
            {% for mov in movimientos %}
              <tr>
                <td>{{ mov.fecha_mov.strftime('%d/%m/%Y') }}</td>
                <td>{{ mov.tipo_mov }}</td>
                <td>{{ mov.rubro_mov }}</td>
                <td>{{ moneda.formato_monto(mov.importe_mov) }}</td>
                <td>{{ mov.detalle_mov }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>No se encontraron movimientos para los filtros seleccionados.</p>
      {% endif %}
    {% endif %}
  </div>
{% endblock %}
