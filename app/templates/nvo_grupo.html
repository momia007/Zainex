<!-- ../templetes/nvo.grupo.html-->
{% extends 'base.html' %}

{% block titulo %}Nuevo Grupo{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block encabezado %}
üß© Crear Nuevo Grupo
{% endblock %}

{% block contenido %}
  <div class="alerta_error">
    {% if mensaje == 'grupo_duplicado' %}
      <p style="color: red;">‚ö†Ô∏è Ya existe un grupo con ese n√∫mero. Por favor, eleg√≠ otro.</p>
    {% elif mensaje == 'numero_invalido' %}
      <p style="color: red;">‚ö†Ô∏è El n√∫mero de grupo debe ser num√©rico.</p>
    {% elif mensaje == 'numero_largo' %}
      <p style="color: red;">‚ö†Ô∏è El n√∫mero de grupo no puede tener m√°s de 6 d√≠gitos.</p>
    {% elif mensaje == 'nombre_vacio' %}
      <p style="color: red;">‚ö†Ô∏è El nombre no puede estar vac√≠o.</p>
    {% elif mensaje == 'distrito_invalido' %}
      <p style="color: red;">‚ö†Ô∏è El distrito debe ser num√©rico.</p>
    {% elif mensaje == 'distrito_largo' %}
      <p style="color: red;">‚ö†Ô∏è El distrito no puede tener m√°s de 6 d√≠gitos.</p>
    {% elif mensaje == 'zona_invalida' %}
      <p style="color: red;">‚ö†Ô∏è La zona debe ser num√©rica.</p>
    {% elif mensaje == 'zona_larga' %}
      <p style="color: red;">‚ö†Ô∏è La zona no puede tener m√°s de 6 d√≠gitos.</p>
    {% endif %}

</div>
<!-- Formulario accesible solo para usuarios con permisos de super usuario.
     Permite cargar nuevos Grupos al sistema -->
<div class="formulario">
  <form id="form-funcion" method="POST" action="/guardar_grupo">

    <label for="numero">N√∫mero:</label><br />
    <input type="text" id="numero" name="numero" required oninput="verificarGrupo(this.Value)" /><br /><br />

    <label for="nombre">Nombre del Grupo:</label><br />
    <input type="text" id="nombre" name="nombre" required /><br /><br />

    <label for="distrito">Nro. Distrito</label><br />
    <input type="number" id="distrito" name="distrito" required /><br /><br />

    <label for="zona">Nro. Zona</label><br />
    <input type="number" id="zona" name="zona" required /><br /><br />

    <br /><br />

    <button type="submit">üíæ Guardar</button>
    <button type="button" onclick="irHome()">Cancelar</button>
  </form>

  <div id="popup" style="display: none; border: 1px solid #999; padding: 15px; background: #eee; margin-top: 20px;">
    <p>üéâ Grupo creado correctamente.</p>
    <button onclick="cargarOtra()">Cargar Otro</button>
    <button onclick="irHome()">Terminar</button>
  </div>
</div>

<script>
    const mensaje = "{{ mensaje | default('') }}";
    if (mensaje === 'ok') {
      document.getElementById('popup').style.display = 'block';
      document.getElementById('btn_guardar').style.display = 'none';
    }

    function verificarGrupo(nombre) {
      if (!nombre.trim()) {
        document.getElementById("mensaje_grupo").textContent = "";
        return;
      }

      fetch(`/existe_grupo/${encodeURIComponent(nombre)}`)
        .then(res => res.json())
        .then(data => {
          const msg = document.getElementById("mensaje_grupo");
          const btn = document.getElementById("btn_guardar");
          if (data.existe) {
            msg.textContent = "‚ö†Ô∏è El grupo ya existe";
            btn.disabled = true;
          } else {
            msg.textContent = "";
            btn.disabled = false;
          }
        });
    }

    function cargarOtra() {
      window.location.href = '/nvo_grupo';
    }

    function irHome() {
      window.location.href = '/home';
    }
  </script>

{% endblock %}